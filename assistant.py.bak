# assistant.py
import asyncio
from stt import STT
from tts import TTS
from model import query_model

def main():
    stt = STT()
    tts = TTS()
    print("ğŸŸ¢ Asistan Ã§alÄ±ÅŸÄ±yor. 'Ã§Ä±kÄ±ÅŸ' diyerek sonlandÄ±rabilirsiniz.")

    while True:
        # 1) Wake word dinle
        audio = stt.listen()
        try:
            text = stt.recognize(audio)
        except Exception as e:
            print(f"â±ï¸ Dinleme/tanÄ±ma hatasÄ±: {e}")
            continue

        text_lower = text.lower()
        if "Ã§Ä±kÄ±ÅŸ" in text_lower:
            print("ğŸ‘‹ Asistan sonlanÄ±yor.")
            break

        if "hey asistan" in text_lower:
            print("ğŸ”” Wake word algÄ±landÄ±, komut dinleniyor...")
            # 2) GerÃ§ek komutu dinle
            audio_cmd = stt.listen()
            try:
                cmd = stt.recognize(audio_cmd)
                print("ğŸ—£ï¸ Komut:", cmd)
            except Exception as e:
                print(f"âŒ Komut tanÄ±ma hatasÄ±: {e}")
                continue

            # 3) Model sorgula
            answer = query_model(cmd)
            print("ğŸ¤– Cevap:", answer)

            # 4) TTS ile oyna
            try:
                asyncio.run(tts.play(answer))
            except Exception as e:
                print(f"âŒ TTS hatasÄ±: {e}")
            # DÃ¶ngÃ¼ yeniden wake word beklemeye dÃ¶ner

if __name__ == "__main__":
    main()